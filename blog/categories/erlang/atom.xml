<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Erlang | Ward Bekker]]></title>
  <link href="http://wardbekker.github.io/blog/categories/erlang/atom.xml" rel="self"/>
  <link href="http://wardbekker.github.io/"/>
  <updated>2013-04-25T10:11:27+02:00</updated>
  <id>http://wardbekker.github.io/</id>
  <author>
    <name><![CDATA[Ward Bekker]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Better visualisation of Erlang fprof traces with kcachegrind]]></title>
    <link href="http://wardbekker.github.io/blog/2013/04/24/valgrind-callgrind/"/>
    <updated>2013-04-24T16:13:00+02:00</updated>
    <id>http://wardbekker.github.io/blog/2013/04/24/valgrind-callgrind</id>
    <content type="html"><![CDATA[<p>You're erlang application is slow. To find the bottleneck, you profile
the code with fprof.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(node@host)1> fprof:apply(module, function, [arguments]).
</span><span class='line'>(node@host)1> fprof:profile().
</span><span class='line'>(node@host)1> fprof:analyse({dest, "outfile.fprof"}).</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The printout of fprof analyse is a text dump of the result, which I
find quite hard to parse and detect the bottlenecks in your code because of all the
noise. Below a truncated sample.</p>

<p><div><script src='https://gist.github.com/5458222.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>

<p><a href="KCachegrind">http://kcachegrind.sourceforge.net</a> to the rescue! With this tool you can visually inspect the fprof
analyse result with sorting, a fancy call graph view, callee map and more.</p>

<p><img src="/images/qcachegrind.png" width="750" height="750" title="image" alt="images"></p>

<p>As KCachegrind can't read fprof analysis output directly, you need to
convert it first with the Erlgrind script.
<a href="download%20here">https://github.com/isacssouza/erlgrind</a>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./erlgrind_script outfile.fprof callgrind.001</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Installation of KCachegrind on a mac (using homebrew) :
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install qcachegrind
</span><span class='line'>$ brew instal graphviz
</span><span class='line'>$ sudo ln -s /usr/local/bin/dot /usr/bin/dot</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
</feed>
